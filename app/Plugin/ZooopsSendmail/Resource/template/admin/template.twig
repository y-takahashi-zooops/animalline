{% extends '@admin/default_frame.twig' %}

{% set menus = ['customer', 'admin_zooops_sendmail_template'] %}

{% block title %}
	{{'admin.customer.customer_template' | trans}}
{% endblock %}
{% block sub_title %}
	{{'admin.customer.customer_management' | trans}}
{% endblock %}

{% block stylesheet %}{% endblock stylesheet %}

{% block javascript %}
<script>
{# テンプレート選択にてテンプレートを選択した場合、IDを付与したアドレスに遷移 #}
$('#mail_template_template_selector').change(function () {
    var id = $(this).val()
	if (id != 0) {
		document.location = '{{ url('admin_zooops_sendmail_template') }}/'+ $('#mail_template_template_selector').val();
	} else {
		document.location = '{{ url('admin_zooops_sendmail_template') }}' ;
	}
});

{# ページ読み込み時に新規テンプレート以外を選択している場合、削除ボタンを活性化させる #}
document.addEventListener("DOMContentLoaded", function () {
	if ($('#mail_template_template_selector').val() != '0') {
		document.getElementById("delete").removeAttribute("disabled");
	}
});

{# フォーム内容更新時、別ページへ移動する際のダイアログ表示 #}
// フラグの初期化
var changeForm = false;

// フォームの内容に変更があった場合、フラグを立てる
$('.checkValue').on('keydown keyup', function() {
	changeForm = true;
});

// フォームの内容に変更があり、画面遷移する場合メッセージ出力
    $(window).on('beforeunload', function(){
	// Choromeではメッセージは変更できないらしい(↓の文言は出ず、固定のメッセージが出力される)
	if (changeForm){
		return 'このページを離れます。よろしいですか？';
	}
});

// フォーム送信時は、メッセージ出力を行わない
$('form[name=mail_template]').submit(function(){
    changeForm = false;
});
</script>
{% endblock javascript %}

{% block main %}
	{{ form_start(form) }}
	{{ form_widget(form._token) }}
	{{ form_widget(form.id) }}
	<div class="c-contentsArea__cols">
		<div class="c-contentsArea__primaryCol">
			<div class="c-primaryCol">
				<div class="card rounded border-0 mb-4">
					<div class="card-header">
						<span class="card-title">{{ 'admin.setting.shop.mail.mail_template_edit'|trans }}</span>
					</div>
					<div class="card-body">
						<div class="row mb-4">
							<div class="col-2">
								<div class="d-inline-block">
									<span>{{'admin.customer.template_selector'| trans}}</span>
								</div>
							</div>
							<div class="col-10">
								{{ form_widget(form.template_selector) }}
							</div>
						</div>
						<div class="borderBottom-ec-dashed"></div>
						<div class="row mb-2 mt-4">
							<div class="col-2">
								<span>{{'admin.customer.template_name'| trans}}</span>
								<span class="badge badge-primary ml-1">{{ 'admin.common.required'|trans }}</span>
							</div>
							<div class="col-10">
								{{ form_widget(form.template_name, {'attr':{'class':'checkValue'}}) }}
								{{ form_errors(form.template_name) }}
							</div>
						</div>
						<div class="row mb-2">
							<div class="col-2">
								<span>{{'admin.customer.template_title'| trans}}</span>
								<span class="badge badge-primary ml-1">{{ 'admin.common.required'|trans }}</span>
							</div>
							<div class="col-10">
								{{ form_widget(form.template_title, {'attr':{'class':'checkValue'}}) }}
								{{ form_errors(form.template_title) }}
							</div>
						</div>
						<div class="row mb-2">
							<div class="col-2">
								<span>{{'admin.customer.template_detail'| trans}}</span>
								<span class="badge badge-primary ml-1">{{ 'admin.common.required'|trans }}</span>
							</div>
							<div class="col-10">
								{{ form_widget(form.template_detail, {'attr':{'class':'checkValue', 'style':'height:400px;'}}) }}
								{{ form_errors(form.template_detail) }}
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="c-conversionArea" id="aside_column">
		<div class="c-conversionArea__container">
			<div class="row justify-content-between align-items-center">
				<div class="col-6">
					<div class="c-conversionArea__leftBlockItem"></div>
				</div>

				<div class="col-6">
					<div
						id="ex-conversion-action" class="row align-items-center justify-content-end">
						{# 削除ボタン：押下で削除モーダルを表示 #}
						<div class="col-auto">
							<button type="button" class="btn btn-danger px-5" id="delete" data-toggle="modal" data-target="#DeleteModal" disabled>{{ 'admin.common.delete'|trans }}</button>
						</div>
						{# 登録ボタン #}
						<div class="col-auto">
							<button class="btn btn-ec-conversion px-5" id="regist" name="regist" type="submit">{{ 'admin.common.registration'|trans }}</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- 削除モーダル -->
	<div class="modal fade" id="DeleteModal" tabindex="-1" role="dialog" aria-labelledby="DeleteModal" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title font-weight-bold">
						{{ 'common.delete_confirm'|trans }}
					</h5>
					<button class="close" type="button" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
				</div>
				{# <div class="modal-body text-left">
					<p class="text-left modal-message"></p>
				</div> #}
				<div class="modal-footer">
					<button class="btn btn-ec-sub" type="button" data-dismiss="modal">
						{{ 'admin.common.cancel'|trans }}
					</button>
					{# 削除ボタン：削除を実行する #}
					<button type="submit" class="btn btn-ec-delete" name="delete">
						{{ 'admin.common.delete'|trans }}
					</button>
				</div>
			</div>
		</div>
	</div>
	{{ form_end(form) }}
{% endblock %}
