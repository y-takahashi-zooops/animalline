{% set site_type = 'breeder' %}
{% form_theme form 'Form/form_div_layout.twig' %}
{% extends 'animalline/breeder/frame.twig' %}

{% block main %}
    <section id="breeder-column" class="breeder-column_dog">
        <div class="inner">
            <div class="ec-pageHeader" style="margin-bottom:2rem;">
                <h1>サイト掲載のための子犬・子猫情報入力</h1>
            </div>
            <div class="ec-off1Grid">
                <div class="ec-off1Grid__cell">
                    <h4 style="margin: 1rem 0 2rem 0">サイトに登録する前に全頭ＤＮＡ検査を行いますので、ＤＮＡ検査キットの送付に必要な情報の入力をお願い致します。</h4>
                    <form method="post" action="" novalidate name="dna-kit-form">
                        {{ form_widget(form._token) }}
                        <h2>子犬・子猫情報</h2>
                        <div class="ec-borderedDefs">
                            <div class="mb-5">
                                <!-- ペット1 -->
                                <dl style="border-bottom:0px">
                                    <dt>
                                        <span class="mr-2">子犬・子猫誕生日1</span>
                                    </dt>
                                    <dd>
                                        <div class="ec-birth date">
                                            {{ form_widget(form.petBirth1) }}
                                        </div>
                                    </dd>
                                </dl>
                                <dl>
                                    <dt>
                                        <span class="mr-2">子犬・子猫出生数1</span>
                                    </dt>
                                    <dd>
                                        <div class="ec-input">
                                            <input type="number" class="form-control petCount" id="dna_check_status_header_petCount1" name="dna_check_status_header[petCount1]" value="{% if request["petCount1"] is defined %}{{ request["petCount1"] }}{% endif %}" min="0" max="6">
                                        </div>
                                    </dd>
                                </dl>
                                <!-- ペット1 -->

                                <!-- ペット2 -->
                                <dl style="border-bottom:0px">
                                    <dt>
                                        <span class="mr-2">子犬・子猫誕生日2</span>
                                    </dt>
                                    <dd>
                                        <div class="ec-birth date">
                                            {{ form_widget(form.petBirth2) }}
                                        </div>
                                    </dd>
                                </dl>
                                <dl>
                                    <dt>
                                        <span class="mr-2">子犬・子猫出生数2</span>
                                    </dt>
                                    <dd>
                                        <div class="ec-input">
                                            <input type="number" class="form-control petCount" id="dna_check_status_header_petCount2" name="dna_check_status_header[petCount2]" value="{% if request["petCount2"] is defined %}{{ request["petCount2"] }}{% endif %}" min="0" max="6">
                                        </div>
                                    </dd>
                                </dl>
                                <!-- ペット2 -->

                                <!-- ペット3 -->
                                <dl style="border-bottom:0px">
                                    <dt>
                                        <span class="mr-2">子犬・子猫誕生日3</span>
                                    </dt>
                                    <dd>
                                        <div class="ec-birth date">
                                            {{ form_widget(form.petBirth3) }}
                                        </div>
                                    </dd>
                                </dl>
                                <dl>
                                    <dt>
                                        <span class="mr-2">子犬・子猫出生数3</span>
                                    </dt>
                                    <dd>
                                        <div class="ec-input">
                                            <input type="number" class="form-control petCount" id="dna_check_status_header_petCount3" name="dna_check_status_header[petCount3]" value="{% if request["petCount3"] is defined %}{{ request["petCount3"] }}{% endif %}" min="0" max="6">
                                        </div>
                                    </dd>
                                </dl>
                                <!-- ペット3 -->

                                <!-- ペット4 -->
                                <dl style="border-bottom:0px">
                                    <dt>
                                        <span class="mr-2">子犬・子猫誕生日4</span>
                                    </dt>
                                    <dd>
                                        <div class="ec-birth date">
                                            {{ form_widget(form.petBirth4) }}
                                        </div>
                                    </dd>
                                </dl>
                                <dl>
                                    <dt>
                                        <span class="mr-2">子犬・子猫出生数4</span>
                                    </dt>
                                    <dd>
                                        <div class="ec-input">
                                            <input type="number" class="form-control petCount" id="dna_check_status_header_petCount4" name="dna_check_status_header[petCount4]" value="{% if request["petCount4"] is defined %}{{ request["petCount4"] }}{% endif %}" min="0" max="6">
                                        </div>
                                    </dd>
                                </dl>
                                <!-- ペット4 -->

                                <!-- ペット5 -->
                                <dl style="border-bottom:0px">
                                    <dt>
                                        <span class="mr-2">子犬・子猫誕生日5</span>
                                    </dt>
                                    <dd>
                                        <div class="ec-birth date">
                                            {{ form_widget(form.petBirth5) }}
                                        </div>
                                    </dd>
                                </dl>
                                <dl>
                                    <dt>
                                        <span class="mr-2">子犬・子猫出生数5</span>
                                    </dt>
                                    <dd>
                                        <div class="ec-input">
                                            <input type="number" class="form-control petCount" id="dna_check_status_header_petCount5" name="dna_check_status_header[petCount5]" value="{% if request["petCount5"] is defined %}{{ request["petCount5"] }}{% endif %}" min="0" max="6">
                                        </div>
                                    </dd>
                                </dl>
                                <!-- ペット5 -->

                                <!-- ペット6 -->
                                <dl style="border-bottom:0px">
                                    <dt>
                                        <span class="mr-2">子犬・子猫誕生日6</span>
                                    </dt>
                                    <dd>
                                        <div class="ec-birth date">
                                            {{ form_widget(form.petBirth6) }}
                                        </div>
                                    </dd>
                                </dl>
                                <dl>
                                    <dt>
                                        <span class="mr-2">子犬・子猫出生数6</span>
                                    </dt>
                                    <dd>
                                        <div class="ec-input">
                                            <input type="number" class="form-control petCount" id="dna_check_status_header_petCount6" name="dna_check_status_header[petCount6]" value="{% if request["petCount6"] is defined %}{{ request["petCount6"] }}{% endif %}" min="0" max="6">
                                        </div>
                                    </dd>
                                </dl>
                                <!-- ペット6 -->
                                <dl>
                                    <dt>
                                        <span class="mr-2">合計掲載頭数</span>
                                        <div style="font-size:12px;color:#F00">一度に請求できるキットは６頭分（６個）です。７個以上の検査キットが必要な場合、マイページのDNA検査キット請求から再度DNA検査キット請求をお願い致します。</div>
                                    </dt>
                                    <dd>
                                        <div class="ec-input{{ has_errors(form.kit_unit) ? ' error' }}">
                                            {{ form_widget(form.kit_unit, { attr : {'readonly': 'true'}}) }}
                                            {{ form_errors(form.kit_unit) }}
                                        </div>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                        <h2>検査キット送付先情報</h2>
                        <div class="ec-borderedDefs">
                            <div class="mb-5">
                                <dl>
                                    <dt>
                                        送付先住所
                                    </dt>
                                    <dd>
                                        <div class="ec-select{{ has_errors(form.choice_address) ? ' error' }}">
                                            {{ form_widget(form.choice_address) }}
                                            {{ form_errors(form.choice_address) }}
                                        </div>
                                    </dd>
                                </dl>
                                <dl>
                                    <dt>
                                        <span class="mr-2">お名前</span>
                                        <span class="ec-required">必須</span>
                                        <div style="font-size:12px;color:#F00">キット送付の宛先となります。表示内容に追加があればご編集ください。<br />郵便でのお届けとなります。表札と同じ宛名をご記入ください。</div>
                                    </dt>
                                    <dd>
                                        <div class="ec-input{{ has_errors(form.shipping_name) ? ' error' }}">
                                            {{ form_widget(form.shipping_name) }}
                                            {{ form_errors(form.shipping_name) }}
                                        </div>
                                    </dd>
                                </dl>
                                <dl>
                                    <dt>
                                        <span class="mr-2">住所<span>
                                        <span class="ec-required">必須</span>
                                        <div style="font-size:12px;color:#F00">〒は'-'を入れずに入力してくだい<br />キット送付先住所となります。表示内容に追加・変更があれば
ご編集ください。</div>
                                    </dt>
                                    <dd class="h-adr">
                                        <span class="p-country-name" style="display:none;">Japan</span>
                                        <div class="ec-zipInput{{ has_errors(form.shipping_zip) ? ' error' }}">
                                            <span>{{ '〒'|trans }}</span>
                                            {{ form_widget(form.shipping_zip) }}
                                            <div class="ec-zipInputHelp">
                                                <div class="ec-zipInputHelp__icon">
                                                    <div class="ec-icon"><img
                                                                src="/html/template/default/assets/icon/question-white.svg"
                                                                alt="">
                                                    </div>
                                                </div>
                                                <a href="https://www.post.japanpost.jp/zipcode/"
                                                target="_blank"><span>郵便番号検索</span></a>
                                            </div>
                                            {{ form_errors(form.shipping_zip) }}
                                        </div>
                                        <div class="ec-select{{ has_errors(form.PrefShipping) ? ' error' }}">
                                            {{ form_widget(form.PrefShipping) }}
                                            {{ form_errors(form.PrefShipping) }}
                                        </div>
                                        <div class="ec-input{{ has_errors(form.shipping_city) ? ' error' }}">
                                            {{ form_widget(form.shipping_city, { 'attr': { 'placeholder': '市区町村名(例：大阪市北区)' }}) }}
                                            {{ form_errors(form.shipping_city) }}
                                        </div>
                                        <div class="ec-input{{ has_errors(form.shipping_address) ? ' error' }}">
                                            {{ form_widget(form.shipping_address,  { 'attr': { 'placeholder': '番地・ビル名(例：西梅田1丁目6-8)' }}) }}
                                            {{ form_errors(form.shipping_address) }}
                                        </div>
                                    </dd>
                                </dl>
                                <dl>
                                    <dt>
                                        <span class="mr-2">電話番号<span>
                                        <span class="ec-required">必須</span>
                                    </dt>
                                    <dd>
                                        <div class="ec-input{{ has_errors(form.shipping_tel) ? ' error' }}">
                                            {{ form_widget(form.shipping_tel) }}
                                            {{ form_errors(form.shipping_tel) }}
                                        </div>
                                    </dd>
                                </dl>
                                {# <dl>
                                    <dt>
                                        キット数量
                                        <div style="font-size:12px;color:#F00">最大6キット</div>
                                    </dt>
                                    <dd>
                                        <div class="ec-input{{ has_errors(form.kit_unit) ? ' error' }}">
                                            {{ form_widget(form.kit_unit) }}
                                            {{ form_errors(form.kit_unit) }}
                                        </div>
                                    </dd>
                                </dl> #}
                            </div>
                        </div>
                        <div class="ec-registerRole__actions">
                            <div class="row">
                                {# <div class="col-md-6">
                                    <a class="ec-blockBtn--cancel" href="{{ url('mypage') }}">マイページに戻る</a>
                                </div> #}
                                {# <div class="col-md-6"> #}
                                <div class="col-md-6 mx-auto">
                                    <button class="ec-blockBtn--action" type="submit" name="mode" value="confirm">登録</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>
    {% if isCheckStatus %}
        {{ include('animalline/components/_modal_check_status.twig') }}
    {% else %}
        {{ include('animalline/components/_modal_confirm.twig') }}
    {% endif %}
    <input type="hidden" id="issetHouseDog" value="{{ breederHouseDog ? 'true' : 'false' }}">
    <input type="hidden" id="issetHouseCat" value="{{ breederHouseCat ? 'true' : 'false' }}">

{% endblock %}
{% block stylesheet %}

{% endblock %}
{% block javascript %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="//yubinbango.github.io/yubinbango/yubinbango.js" charset="UTF-8"></script>
<script>
    if ($("#issetHouseDog").val() == 'false') {
    $("#dna_check_status_header_choice_address option[value='2']").remove();
}
    if ($("#issetHouseCat").val() == 'false') {
    $("#dna_check_status_header_choice_address option[value='3']").remove();
}
    $(document).on('change', '#dna_check_status_header_choice_address', function() {
    var name = $(this).val() == 1 ? '{{breeder.breederName}}' : $(this).val() == 2 ? '{{breederHouseDog ? breeder.breederHouseNameDog}}' : '{{breederHouseCat ? breeder.breederHouseNameCat}}';
    var zip = $(this).val() == 1 ? '{{breeder.breederZip}}' : $(this).val() == 2 ? '{{breederHouseDog ? breederHouseDog.breederHouseHouseZip}}' : '{{breederHouseCat ? breederHouseCat.breederHouseHouseZip}}';
    var pref_id = $(this).val() == 1 ? '{{breeder.PrefBreeder.Id}}' : $(this).val() == 2 ? '{{breederHouseDog ? breederHouseDog.BreederHousePrefId.Id}}' : '{{breederHouseCat ? breederHouseCat.BreederHousePrefId.Id}}';
    var city = $(this).val() == 1 ? '{{breeder.breederCity}}' : $(this).val() == 2 ? '{{breederHouseDog ? breederHouseDog.breederHouseCity}}' : '{{breederHouseCat ? breederHouseCat.breederHouseCity}}';
    var addr = $(this).val() == 1 ? '{{breeder.breederAddress}}' : $(this).val() == 2 ? '{{breederHouseDog ? breederHouseDog.breederHouseAddress}}' : '{{breederHouseCat ? breederHouseCat.breederHouseAddress}}';

    $("#dna_check_status_header_shipping_name").val($(this).val() ? name : '')
    $("#dna_check_status_header_shipping_zip").val($(this).val() ? zip : '')
    $("#dna_check_status_header_PrefShipping").val($(this).val() ? pref_id : '')
    $("#dna_check_status_header_shipping_city").val($(this).val() ? city : '')
    $("#dna_check_status_header_shipping_address").val($(this).val() ? addr : '')
});

    $("form[name=dna-kit-form]").submit(function (e) {
    e.preventDefault();
    $('#modal').modal('show');
});

$("#confirm-yes").click(function (e) {
    document.getElementsByName('dna-kit-form')[0].submit();
});
$("#confirm-back").click(function () {
    window.history.back();
});

function textCheck($this)
{
  let str=$this.value;
  // 数字チェック
  if(!str.match(/^[0-9０-９]+$/)){
    // 文字の場合は空白に変換
    str="";
  } else if(str.match(/^[０-９]+$/)){
    // 全角数字の場合は半角数字に変換
    str=toHanKaku(str);
  }
  $this.value=str;
}

function toHanKaku(str) {
    return str.replace(/[０-９]/g, function(s){
        return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
    });
}

// 出生数の合計を合計頭数にする
var Input = $('.petCount'); 
var Output = $('#dna_check_status_header_kit_unit');
Input.on('change', function() {
    var num1 = Number($('#dna_check_status_header_petCount1').val());
    var num2 = Number($('#dna_check_status_header_petCount2').val());
    var num3 = Number($('#dna_check_status_header_petCount3').val());
    var num4 = Number($('#dna_check_status_header_petCount4').val());
    var num5 = Number($('#dna_check_status_header_petCount5').val());
    var num6 = Number($('#dna_check_status_header_petCount6').val());
    var total = num1 + num2 + num3 + num4 + num5 + num6;
    Output.val(total);
});

</script>
{% endblock %}