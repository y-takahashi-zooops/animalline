{% set site_type = 'breeder' %}
{% set params = app.request.query.all %}
{% extends 'animalline/breeder/frame.twig' %}

{% block main %}
    <section id="breeder-mv">
        <div class="inner">
            <div class="breeder-mv__container">
                <div class="breeder-mv__text">
                    <h2>テキストが入りますテキストが入りますテキストが入ります</h2>
                    <div class="breeder-mv__text_logo">
                        <img src="{{ asset('assets/img/breeder-mv-logo.png') }}" alt="Animalline Breeder" />
                    </div>
                    <p>キャッチコピーが入ります。</p>
                    <div class="breeder-mv__text_btn">
                        <ul>
                            {% if petKind == constant('Customize\\Config\\AnilineConf::ANILINE_PET_KIND_DOG') %}
                                <li class="breeder-mv__text_btn_dog">
                                    <span><i>犬を飼育</i></span>
                                </li>
                                <li class="breeder-mv__text_btn_cat">
                                    <a href="{{ url('breeder_search', {'pet_kind': constant('Customize\\Config\\AnilineConf::ANILINE_PET_KIND_CAT')}) }}">
                                        <i>猫を飼育</i>
                                    </a>
                                </li>
                            {% else %}
                                <li class="breeder-mv__text_btn_dog">
                                    <a href="{{ url('breeder_search', {'pet_kind': constant('Customize\\Config\\AnilineConf::ANILINE_PET_KIND_DOG')}) }}">
                                        <i>犬を飼育</i>
                                    </a>
                                </li>
                                <li class="breeder-mv__text_btn_cat">
                                    <span><i>猫を飼育</i></span>
                                </li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
                <div class="breeder-mv__search">
                    <div class="breeder-mv__search_wrap breeder-mv__search_dog">
                        <div class="breeder-mv__search_title breeder_search">
                            <h2>ブリーダーを探す</h2>
                        </div>
                        <div class="breeder-mv__search_body">
                            <form action="{{ url('breeder_search') }}" method="get">
                                <input type="hidden" name="pet_kind" value="{{ petKind }}">
                                <div class="breeder-mv__search_top">
                                    <div class="select-container">
                                        <select class="form_dropdown w-100" id="formControlSelect1" name="breed_type">
                                            <option value="">種類</option>
                                            {% for breed in breeds %}
                                                <option value="{{ breed.id }}" {% if params.breed_type is defined and params.breed_type== breed.id %} selected {% endif %}>
                                                    {{ breed.breedsName }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="breeder-mv__search_bottom">
                                    <div class="breeder-mv__search_bottom_w50">
                                        <div class="select-container">
                                            <select class="form_dropdown w-100" id="formControlSelect3" name="region">
                                                <option value="">都道府県</option>
                                                {% for region in regions %}
                                                    <option value="{{ region.id }}" {% if params.region is defined and params.region == region.id %} selected {% endif %}>
                                                        {{ region.name }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <label>
                                            <input type="checkbox" name="adjacent" value="1" {% if params.adjacent is defined and params.adjacent == 1 %} checked {% endif %}>
                                                隣の都道府県も検索
                                        </label>
                                    </div>
                                    <div class="breeder-mv__search_bottom_w50">
                                        <div class="select-container">
                                            <input type="text" id="breeder_house_name" placeholder="ブリーダー名" class="form_input w-100" name="license" {% if params.license is defined %} value="{{ params.license }}" {% endif %}></div>
                                        </div>
                                    </div>
                                    <div class="breeder-mv__search_btn">
                                        <button><i class="bi bi-check2-square"></i>この条件で検索する</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="breeder-column" class="breeder-column_dog">
        <div class="inner">
            <div class="breeder-column__main_section" id="breeder-column__main_section_dog_new">
                <div class="breeder-column__main_section_title">
                    <h3>検索結果</h3>
            </div>
            <div class="breeder-column__main_section_body">
                {% for breeder in breeders %}
                    <div class="row ml-2 mb-4">
                        <div class="breeder-img col-md-3 col-sm-4">
                            {# <a href="{{ url('breeder_detail', {'breeder_id': breeder.Id}) }}"> #}
                            <img src="{{ app.request.schemeAndHttpHost ~ (breeder.thumbnailPath | default | length > 0 ? breeder.thumbnailPath : '/' ~ constant('Customize\\Config\\AnilineConf::ANILINE_IMAGE_URL_BASE') ~ '/noimage_plugin_list.png') }}" class="w-100 mb-4 mb-sm-0">
                            {# </a> #}
                        </div>
                        <div class="breeder-info col-sm-8">
                            <h4 class="font-weight-500 color-gray-500">
                                {{ breeder.licenseHouseName }}
                                ブリーダー                                
                            </h4>
                            <div class="d-flex mb-1">
                                <h4>
                                    総合評価 :
                                </h4>
                                <div class = "stars-outer">
                                    <div class = "stars-inner"></div>
                                </div>
                                <div class="m-1 p-1"></div>
                                <h4 class = "number-rating">
                                    {{ breederPet.Breeder.getBreederRank() }}
                                </h4>
                            </div>
                                <div class="d-flex mb-1">
                                    <h6>動物取扱業登録番号：</h6>
                                    <h6>
                                        {{ breeder.licenseNo }}
                                    </h6>
                                    <div class="m-1 p-1"></div>
                                    <h6>登録：</h6>
                                    <h6>
                                        {{ breeder.licenseRegistDate | date('Y/m/d') }}
                                    </h6>
                                </div>
                                <div class="d-flex mb-1">
                                    <h6>有効期限：</h6>
                                    <h6>
                                        {{ breeder.licenseExpireDate | date('Y/m/d') }}
                                    </h6>
                                    <div class="m-1 p-1"></div>
                                    <h6>動物取扱責任者：</h6>
                                    <h6>
                                        {{ breeder.licenseManagerName }}
                                    </h6>
                                </div>
                                <div class="d-flex mb-1">
                                    <h6>犬舎所在地：</h6>
                                    {% set breederHouseDog = breeder.getBreederHouseByPetType(constant('Customize\\Config\\AnilineConf::ANILINE_PET_KIND_DOG')) %}
                                    {% set breederHouseCat = breeder.getBreederHouseByPetType(constant('Customize\\Config\\AnilineConf::ANILINE_PET_KIND_CAT')) %}
                                    {% if (breeder.handlingPetKind == constant('Customize\\Config\\AnilineConf::ANILINE_PET_KIND_DOG_CAT')) %}
                                        <h6>
                                            {{ breederHouseDog.breederHousePref ~ breederHouseDog.breederHouseCity ?? '' ~ ' ' ~ breederHouseCat.breederHousePref ~ breederHouseCat.breederHouseCity ?? '' }}
                                        </h6>
                                    {% elseif (breeder.handlingPetKind == constant('Customize\\Config\\AnilineConf::ANILINE_PET_KIND_DOG')) %}
                                        <h6>
                                            {{ breederHouseDog.breederHousePref ~ breederHouseDog.breederHouseCity ?? '' }}
                                        </h6>
                                    {% else %}
                                        <h6>
                                            {{ breederHouseCat.breederHousePref ~ breederHouseCat.breederHouseCity ?? '' }}
                                        </h6>
                                    {% endif %}
                                </div>
                                <div class="d-flex mb-1">
                                    <h6>審査ステータス：</h6>
                                    {% if breeder.examinationStatus() == constant('Customize\\Config\\AnilineConf::ANILINE_EXAMINATION_STATUS_NOT_SUBMIT') %}
                                        <h6>審査前</h6>
                                    {% elseif breeder.examinationStatus() == constant('Customize\\Config\\AnilineConf::ANILINE_EXAMINATION_STATUS_NOT_CHECK') %}
                                        <h6>審査中</h6>
                                    {% elseif breeder.examinationStatus() == constant('Customize\\Config\\AnilineConf::ANILINE_EXAMINATION_STATUS_CHECK_OK') %}
                                        <h6>審査OK</h6>
                                    {% elseif breeder.examinationStatus() == constant('Customize\\Config\\AnilineConf::ANILINE_EXAMINATION_STATUS_CHECK_NG') %}
                                        <h6>審査NG</h6>
                                    {% endif %}
                                </div>
                                <a href="{{ url('breeder_detail', {'breeder_id': breeder.Id}) }}">
                                    <h5 class="color-breeder">ブリーダー詳細ページへ</h5>
                                </a>
                            </div>
                        </div>
                        {% if breeder.prText %}
                            <div class="row ml-2 mb-4">
                                <div class="col-12" style="background:#fff3dd">
                                <h6 style="border-bottom: 1px dotted #cd8362; color:#cd8362;">PRコメント</h6>
                                <h6>{{ breeder.prText |nl2br }}</h6>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                {% else %}
                    検索条件に該当するブリーダーが存在しません。
                {% endfor %}
                <div class="navigation float-right">
                    {{ knp_pagination_render(breeders) }}
                </div>    
            </div>
        </div>
    </section>
{% endblock %}
{% block stylesheet %}
    <link rel="stylesheet" href="{{ asset('assets/css/breeder-style.css') }}">
    <style>
        .stars-outer {
            position: relative;
            display: inline-block;
            bottom: 5px;
            margin-left: 15px;
        }
        .stars-inner {
            position: absolute;
            top: 0;
            left: 0;
            white-space: nowrap;
            overflow: hidden;
            width: 0;
        }
        .stars-outer::before {
            content: "\f005 \f005 \f005 \f005 \f005";
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            color:#ccc;
        }
        .stars-inner::before {
            content: "\f005 \f005 \f005 \f005 \f005";
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            color:#f8ce0b;
        }
    </style>
{% endblock %}
{% block javascript %}
<script>
    const starTotal = 5;
    document.addEventListener('DOMContentLoaded', getRating());
    function getRating() {
    const starPercentage = ({{ breederPet.Breeder.getBreederRank() }} / starTotal) * 100;
        document.querySelector('.stars-inner').style.width = `${Math.round(starPercentage/10)*10}%`;
    }
</script>
{% endblock %}
                